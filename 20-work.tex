\chapter{Bedrohungen}

Die meisten DNS-Sicherheitsrichtlinien richten sind an Betreiber von extern gerichteten Installationen. Das Thema "DNS Client Security" wird wenn nur am Rande behandelt. Der nachfolgende Abschnitt befasst sich daher von den gängigsten Bedrohungen mit speziellem Fokus auf die Interaktion zwischen DNS-Resolver und rekursivem DNS-Server. 
Es gibt dabei zwei grundlegende Möglichkeiten einen DNS-Client anzugreifen: Erstens über direktes kommunizieren mit der Netzwerkschnittstelle des Clients, zweitens mittels Angriff auf einen Teil der Client-nahen Infrastruktur. Um die Auswirkung klar ersichtlich zu machen wird in \ref{sec:BedrohungenÜbersicht} eine tabellarische Zusammenfassung mit den verletzen Sicherheitskriterien (nach CIA-triade) geben. 

\section{Direkte Angriffe}

Angriffe die das Verhalten einzelner DNS-Clients über eingreifen in deren Kommunikationsfluss beeinflusst kann als "direkte Angriffe" zusammenfassen. Diese Verfahren sind nur effezient wenn der Angreifer entweder passiv (Sniffing) oder aktiv (Man-in-the-middle) an der Netzwerkverbindung des Clients beteiligt ist. 

\subsection{DNS Sniffing}

Als Sniffing Angriffe werden alle Arten von Angriffen bezeichnet die ein mitlesen von Nachrichten zwischen mindestens 2 Parteien involvieren (https://capec.mitre.org/data/definitions/157.html). Im DNS Kontext hat dies eine spezielle Bedeutung da es ermöglicht, aufgrund des fehlenden Schutz der Vertraulichkeit, alle Informationen der Anfragen, sowie Anworten einzusehen. Somit ist das Kommunikationsverhalten der Opfergeräte leicht nachzuvollziehen, was den Recon-Schritt der Cyber-Kill-Chain erheblich erleichtert. 

In IP-Netzen gibt es verschieden Möglichkeiten eine Sniffing Attacke (https://capec.mitre.org/data/definitions/158.html) durchzuführen: 

Eine Möglichkeit ist der Angriff der Netzwerkhardware. Bei einem Hub als Netzwerkverteiler erhalten immer alle angeschlossenen Teilnehmer alle Packete. Es können daher die Packete aller anderen an diesem Hub angeschlossenen Geräte einfach mitgelesen werden. Wird ein Switch einsetzt wird für jeden Anschluss (Port) die MAC-Adresse des angeschlossenen Geräts in eine Tabelle eingetragen. Es werden somit nur noch Pakete mit passender MAC-Adresse an die entsprecheden Ports weitergeleitet. Ein Angreifer kann bestimme Switches jedoch durch kunstliche Füllen der MAC-Switching-Tabelle (MAC-Flooding Angriff) in ein, einem Hub ähnliches, Verhalten zwingen. Soll ein spezielles Endgerät mit bekannter MAC-Adresse angegriffen werden, kann bei anfälligen Switches auch ein MAC-Duplication Angriff durchgeführt werden. Dabei sendet der Angreifer Packete mit der gefälschter MAC-Adresse des Opfers was den Switch dazu verleitet die Adresse auf zwei Ports einzutragen. Anfällige Switches senden daraufhin die Pakete des Opfers auch auf den Port des Angreifers.

Ist die Netzwerkhardware nicht angreifbar bleibt noch die Möglichkeit den Netzwerkstack der Client-Geräte direkt zu attackieren. Hier wird in den meißten Fällen eine Schwachstelle im "Address Resolution Protocol" (ARP) ausgenützt. Dieses ist für die Auflösung von IP- zu MAC-Adressen verantwortlich. Da es auf Ethernet-Broadcasts aufsetzt, somit Verbindungslos ist und keinerlei Form von Authentifizierung verlangt kann ein Angreifer seine MAC-Adresse als Antwort auf die Frage nach der IP-Adresse des Gateways senden. Somit senden betroffenen Rechner alle an den default Gateway adressierten Packete unwissentlich an das Gerät des Angreifers. Eine weitere Möglichkeit sich als gefälschter Gateway zu positionieren ist DHCP-Spoofing. Bei diesem Angriff werden gefälschte DHCP-Packete gesendet die statt des achten default Gateways die IP des Angreifers enthalten. Da DHCP oft auch für das verteilen von DNS-Server Andressen genützt wird, kann auch nur ein vom Angreifer kontrollierter DNS-Server eingetragen werden. Eine spezielle Methode stellt das ICMP-Redirect ...

Außerdem wird DNS hauptsächlich über UDP verwendet, was ein fälschen (spoofing) der Absenderadresse trivial macht. Da dadurch auch die Transaktions ID und das Absendeport bekannt wird, kann der Angreifer sofort ein gefältes Antwortpacket senden und somit den Eintrag der abgefragten Domäne im Resolver des Ziels beliebig verändern oder erweitern. Durch das setzen von hohen TTL Werten kann dieser Zustand lange über die physische Präsenz des Angreifers hinaus aufrecht erhalten werden.



% Sniffing und Spoofing gemischt?!

\begin{comment}
Wenn sniffing des Netzwerks möglich, dann DNS kein problem, da keinerlei Privicy. Auch bei DNSSEC ein Problem. DNSCrypt, DNSCurve, DNS-over-TLS, DNS-over-HTTPS lösen diese Probleme. Noch kein nativer support in vielen OS (atm nur experimentell in Andoid)
\end{comment}

\subsection{DNS Spoofing}

\begin{comment}
* DNS Spoofing/Faking ermöglicht MitM
* Speziell bei IOT da durch begrenzte Leistung oft keine Verschlüsselung. Bei HTTPS trotzdem Möglichkeiten durch Social-Engineering
\end{comment}

\subsection{DNS Rebinding}

\begin{comment}
Durch DoS von Resolvern oder DNS-Servern können kritischen Unternehmensdienste kurzfristig außer Betrieb genommen werden. Da die Verbindung zwischen diesen hoch vernetzten Diensten stark von DNS abhängt hat der Ausfall eines einzigen zentralen Dienstes (DynDns Vorfall) schwerwiegende Auswirkungen auf alle anhängenden Dienste.
\end{comment}

\subsection{DNS Spoofing (Blindflug)} % BS?!
Da DNS, wie in \ref{sec:DNS} beschreiben, auf UDP aufsetzt, kann die Absenderadresse leicht gefälscht werden. Existiert nun eine Schwachstelle in der Implementierung des lokalen DNS-Resolver kann die TXID leicht erraten werden. 

\section{Indirekte Angriffe}

\subsection{Reliance Upon Transitive Trust}

\begin{comment}
* Unbemerkte übernehme von Domänen möglich
* Komplimitierung von Stakeholder-Diensten möglich
  * Bei Websites  (HTTP od. uralt Browser mit Mixed Active Content) führt die komprimitierung eines einzigen Ressourcenservers zum komprimitierung der gesamten Seite: XSS wird einfach möglich wenn z.B. eine JS-Datei eines Werbeanbieters in die Seite geladen werden kann.
  * Wenn eine einzige aktive Ressource über http nachgeladen wird oder für TLS Attacken (Poodle, ) anfällig ist, kann die seite und somit der client angegriffen werden.
* Bei nicht verschüsselten Netzwerkprotokollen (plain SMTP/POP3/IMAP, FTP, MQTT) kann die Verbindung vollständig übernommen werden.
* In jedem Fall sorgt eine erfolgreiche Attacke zum Übergang der Verfügbarkeitskontrolle an den Angreifer (bis zum Erkennen das Problems und entfernen der eingeschläuschten Einträge)
\end{comment}

\subsection{Name Collisions and Leaked Queries} 

\begin{comment}
* Durch eigene interne TLDs (z.B. .local) kann es zu Kollisionen im globalen Namespace kommen (new TLDs).
* Mögliche Kollisionen können bewusst ausgenutzt werden.
* Durch falsch/schlecht konfigurierte DNS-Resolver können interne Anfragen zu externen DNS-Servern getragen werden -> Information Disclousure
* Speziell bei "home-use" und ohne "LockDown" kann durch lokale Proxies und Resolver von "leakage" betroffen sein. Auch BYOD-Geräte speziell gefährdet wenn durch falsche Konfiguration DNS-Anfragen zum Auflösen internen Ressourcen an externe DNS-Server gestellt werden.
\end{comment}

\subsection{C&C/Exfiltration über DNS Tunneling}

\begin{comment}
* Mit allen "offenen" resolvern nutzbar
* Bei "best-practice"-Einstellungen des resolvers sehr langsam
* Nicht einfach zu erkennen
* Für sehr kleine Datenmengen durchaus zuverlässig (C&C)
* KillChain: Data Exfiltration, Controll
\end{comment}

\chapter{Lösungsmöglichkeiten}

% Wohin damit verdammt?!
\subsection{DNSSEC}

\section{Sichern des R2C-Transfers (Vertraulichkeit, Authentizität und Integrität)}

\subsection{IPSec}

\subsection{DNSCurve}

\subsection{DNSCrypt}

\subsection{DNS-over-HTTPS}

\subsection{DNS-over-TLS}

\subsection{DNS over QUIC}

\section{Serverseitige Schutzmechanismen}

\subsection{DNS-Resolver}

\begin{comment}
Wenn kein DNSSEC erzwungen wird (was noch schwer möglich ist) muss das risiko flascher Records akzeptiert werden. Über spezielle, vertrauenswündige Resolver kann das Risiko jedoch verringert werden.
\end{comment}

\subsection{Fortify Internal Resolvers}

\subsection{Analyze Navigation Telemetry}

\section{Allgemeine Empfehlungen}

\subsection{DNSSEC}

\subsection{DNS-over-TLS}
\subsection{Server- / Netzwerkaufbau}
\subsection{Netwerksetup}
\subsection{Vertrauenswürdige Resolver / Upstream-DNS Server od. IDS}

\begin{comment}
*Nur mit entsprechender Validierung des Zeilservers (DoT, etc.) weil sonst anfällig auf MitM, BGP-Hijacking, usw.*
\end{comment}

\section{Konkrete Konzepte}

\subsection{Enterprise: local-only DNS-Resolver mit DNSSEC und IDS, HTTP-Proxy for Clients/internal Servers}

\subsection{Privat/EPU: DNS-over-TLS  mit Trusted Resolver (z.B. Stubby and Quad9)}