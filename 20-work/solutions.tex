\chapter{Lösungsmöglichkeiten}
\label{chap:solutions}
% Noch nicht auf spezielle technische Lösungen eingehen!

\section{Authentizität der Records}
\label{sec:solution-recordauth}
Wie in Kapitel \ref{sec:thread-auth} beschrieben wurde, ist die Authentizität der RR ein zentrales Problem in DNS. Zur Lösung wurde schon früh der Einsatz kryptografischer Signaturen postuliert. Mithilfe dieser könnten alle Einträge bei der Erstellung signiert, zusammen mit den Signaturen übertragen und dann von der Gegenstelle validiert werden. Dadurch wird es möglich die Integrität und Authentizität der empfangenen Einträge eindeutig sicherzustellen. Werden die Zonendateien nur bei Änderung signiert und der private Schlüsselteil anschließend wieder entfernt, besteht sogar die Möglichkeit Server-Konfigurationen vor ungewollter Veränderung zu schützen. 
Die zentralen Fragen sind dabei, wie bei allen Signaturverfahren, das Schlüsselmanagement und die damit verbundene Vertrauensstellung zwischen den einzelnen Parteien. Das notwendige Vertrauen kann dabei auf verschiedenste Wege erreicht werden (siehe Kapitel \ref{chap:itsecurity}).
Des weitern ist zu erwähnen, dass die Integrität der Nachrichten trotz Signatur nicht immer garantiert werden kann. Einige Signaturmechanismen, konkret die darin genützten Hash-Algorithmen, weisen bekannte Schwächen auf, die bei einem Angriff ausgenützt werden können. Ein aktuelles Beispiel stellt der Angriff auf den weit verbreiteten SHA-1 Algorithmus dar\cite{Stevens2017}. 

\section{Authentizität der autoritativen Server}
Neben der in Abschnitt \ref{sec:solution-recordauth} erwähnten Authentizität der RR selbst, spielt auch die Authentizität der autoritativen DNS-Server selbst eine Rolle. Einige der angeführten Angriffe, nutzen den Umstand, dass Resolver keine Möglichkeit besitzt die Identität der Gegenstellen zu prüfen. Dies ist, aufgrund des zustandslosen Grundkonzepts, selbst zwischen Anfrage und Antwort zutreffend. Nach Standard verlässt sich ein Resolver ausschließlich auf die Kombination aus Adresse, Port und TXID um eine Antwort einer ausstehenden Anfrage zuzuordnen. Dies ist Grundlage für die meisten Angriffe gegen Resolver.

Eine Lösung besteht prinzipiell in der Signatur der Records, ist jedoch auch einfacher möglich. Lässt man die \textit{Authentizität der Records} außer acht, genügt es eine kurzlebige Vertrauensstellung zwischen Resolver und autoritativen Server herzustellen. Dies kann über klassischen hybriden Verschlüsselungsverfahren erreicht werden, die asymmetrische Kryptografie für die Authentifizierung und den Schlüsselaustausch, sowie symmetrische Kryptografie für die Datenverschlüsselung einsetzen.

\section{Authentizität des Resolvers}
In Kapitel \ref{sec:thread-auth} wurde erwähnt, dass es in DNS-Netzwerkprotokoll keine Möglichkeit gibt die Authentizität der Gegenstelle, im speziellen des Resolvers, zu prüfen. Abhilfe für dieses Problem schafft einerseits das zuvor besprochene kryptographische Signieren der Einträge, da so bei einem Eingriff keine unbemerkte Modifikation des Inhalts möglich ist. Dieser Schutz scheitert jedoch an der praktischen Umsetzung, da es einen Fallback-Mechanismus ausschließen müsste, da ansonsten eine Downgrade-Attacke möglich wäre\cite{Bau2010}. Bei diesem Angriff werden dafür die Signaturen aus dem Antwort-Paket entfernt. Dies erzeugt den Eindruck , dass der Server die Unterstützung von DNSSEC eingestellt hat. Die Anfrage werden in anfälligen Konfigurationen nach ungeschütztem DNS abgearbeitet und sind damit wieder normal angreifbar.  

Eine mögliche Lösung dieses Problem stellt das einführen eines Authentifizierungsverfahren dar. In den meisten Fällen wird dafür eine asymmetrischer Kryptografie basierende Methode eingesetzt. Dieses besteht aus 2 Schritten: Als erstes teilt die fragliche Endstelle seinen öffentlichen Schlüssel mit, der Client trifft nun eine Entscheidung ob er dem Schlüssel vertraut oder nicht. Wir schon in Abschnitt \ref{sec:solution-recordauth} erwähnt, gibt es dafür verschiedene Methoden um das notwendige Vertrauen zu dem gegebenen Schlüssel herzustellen und zu prüfen. Der zweite Schritt stellt sicher, dass die Endstelle auch im Besitz des passenden, privaten Schlüssels ist. Dabei wird oft die Authentifizierung und die Sitzungsschlüsselübertragung zusammengefasst. Der Client überträgt dabei seinen Informationsteil für die Sitzungsschüsselerstellung verschlüsselt mit dem öffentlichen Schlüssel des Gegenübers. Eine erfolgreiche Aushandlung des Sitzungsschlüssels ist damit nur möglich wenn die Endstelle die Nachricht auch entschlüsseln kann, was nur mit passendem privaten Schlüssel möglich sein sollte. 

\section{Vertraulichkeit der Verbindung}
Wie in Abschnitt \ref{sec:thread-priv} dargelegt ist DNS-Privacy zu einem wichtigen Thema geworden. Die nachhaltige Lösung zur Sicherstellung der Vertraulichkeit ist, wie damals auch bei HTTP, der Einsatz einer geeigneten Transportverschlüsselungstechnologie. Auf welcher Ebene diese Stattfindet ist dafür grundsätzlich nicht relevant. Der Einsatz von etablierten Technologien wie TLS liegt jedoch nahe, obwohl für DNS auch alternative Lösungen entwickelt wurden. 

\todo[inline]{``Vertraulichkeit der Verbindung'': Bissal gar dünn}


\section{Vertraulichkeit der Anfragen}
\label{sec:solutions-PrivRequest}
Ein in der Vergangenheit wenig beachtetes Problem ist die Vertraulichkeit der Anfragen selbst und damit das notwendige Vertrauen an die Betreibenden der DNS-Infrastruktur selbst. Speziell Rekursive Resolver von großen ISPs akkumulieren eine große Menge an DNS-Daten, welche auf vergleichsweise einfache Art zur Nachvollziehung von Kommunikationsverläufe der Nutzenden herangezogen werden kann. Zum umgehen dieser Schwachstelle gibt es zwei getrennte Entwürfe.

Auf der einen Seite gibt es Vorschläge die darauf abzielen personenbezogene Informationen wie die IP-Adresse bewusst von den Anfragedaten zu trennen. Dafür wird der Umstand ausgenützt, dass es möglich ist die Anfragen- und Antwortdaten von den Kommunikationsdaten zu trennen. Dies wird durch einen, für den Recursive Resolver transparente, Ende-zu-Ende-Verschlüsselung zwischen Stub Resolver und einem speziellen DNS-Server möglich. Der DNS-Server entschlüsselt dabei die erhaltene Anfrage und löst diese rekursiv auf, verschlüsselt die Antwort und sendet diese an der Recursive Resolver zurück, welcher die Antwort an den Client weiterreicht. Durch dieses Verfahren kann der Recursive Resolver weder Anfrage noch Antwort lesen, wobei der eigentlich auflösende Server zwar die Daten aber keinen Hinweis auf die Identität des Client erhält.

Ein komplett anderer Entwurf basiert auf der Ablöse des DNS als Gesamtheit, da davon ausgegangen wird, das DNS, aufgrund seines Grundkonzepts, nie strengen Ansprüchen auf Vertraulichkeit genügen wird. Diese Alternativkonzepte bauen die für ein Namensauflösungssystem notwendige verteile Datenbank mithilfe von Technologien wie Dirstibute-Hash-Tables (DHT) oder Public Ledger auf Blockchain-Basis auf. Da diese Lösungsentwürfe radikal vom bestehenden Konzept des DNS abweichen, werden sie hier nicht weiter behandelt.      

\section{Trennen von Adresse und Anfrage}
\label{sec:goals-sourceanon}
Um die sensiblen Verbindungsdaten zu Schützen ist es wichtig die Anonymität der anfragenden Person zu wahren. Konkreter sollen Adressen die mit der entschlüsselten Anfrage in Verbindung steht, nicht auf die anfragende Person zurückführbar sein. Durch den Einsatz von rekursiven Resolvern wird diese Kombination aus Adresse und Anfrage zwar vor den autoritativen DNS-Servern verborgen, verschiebt das Problem jedoch lediglich auf den Resolver. 

Die Lösung besteht nun in der simplen Trennung von Adresse des Clients und dessen entschlüsselter Anfrage bzw. Antwort. Um dies zu ermöglichen ist es notwendig, das der erste, vom Client direkt angesprochene Server, nicht in der Lage ist die echte DNS-Anfrage oder Antwort zu entschlüsseln. Die Aufgabe dieses Servers besteht darin die wahre Adresse des Clients zu verbergen und an die Anfrage von einen anderen Adresse aus an einen Resolver weiterzuleiten. Der Resolver muss dann in der Lage sein, die Anfrage zu Entschlüsseln, ist aber nicht mehr in Kenntnis über die echte Adresse des Fragestellers. Damit ist das problematische Tupel aus Adresse und Daten aufgelöst, was zur Verbesserung der Privacy beiträgt \cite{Schmitt2018}.

\section{Verbindungbehaftete Protokolle einsetzen}
\label{sec:goals-trafficamp}
Abgesehen von der Verfügbarkeit des DNS selbst, wird es, wie in Abschnitt \ref{sec:thread-dosamp} und \ref{sec:attack-dosamp} beschrieben, auch selbst als Verstärker (Traffic Amplification; DoS Amplification Attack) für DoS-Attacken eingesetzt. Es ist daher für zum Schutz anderer Internet-Services essenziell, dass DNS und dessen Implementierungen nicht lohnender für Traffic-Amplification Versuche sind als andere Services.

Die einfachste Möglichkeit einer Lösung besteht im Ablösen des Verbindungslosen UDP zugunsten eines Verbindungsorientierten Protokolls wie TCP. Der notwendige Verbindungsaufbau könnte im Falle eines klassischen IP-Spoofings nicht abgeschlossen werden, was das Stellen einer Anfrage verhindern würde. Damit wäre DNS nicht mehr als Verstärker nutzbar. Die Nachteile dieser Lösung bestehen jedoch in ihrem Vorteil, da der Verbindungsaufbau viel Zeit in Anspruch nimmt und zusätzliche Ressourcen auf dem Server binden würde. Wie festgestellten werden konnte, ist die Auswirkung auf die Performance in den meisten Fällen jedoch stark überschätzt\cite{Zhu2015}.

Es ist anzumerken, dass Protokolle wie DTLS, trotz UDP, eine Form von Sitzung aufbauen, was die Möglichkeit zum Einsatz als Verstärker ebenfalls erschweren würde\cite{rfc6347}. 

\section{Härten des Resolvers}

\begin{draft}
    \begin{itemize}
        \item Source Port randomization
        \item ACLs am Resolver
        \item In-Domain check for Glue Records
        \item 0x20 
        \item TXID Randomization
        \item TTL min. 
    \end{itemize}

(https://tools.ietf.org/html/rfc545)

\end{draft}
